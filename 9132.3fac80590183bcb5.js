"use strict";(self.webpackChunkintswap_frontend=self.webpackChunkintswap_frontend||[]).push([[9132,1621],{1621:($,S,a)=>{a.d(S,{D:()=>k});var p=a(2085),h=a(408),y=a(8499),d=a(5955);function k(T){return(0,p.e)((A,m)=>{let f=!1,b=null,e=null;const x=()=>{if(e?.unsubscribe(),e=null,f){f=!1;const _=b;b=null,m.next(_)}};A.subscribe((0,y.x)(m,_=>{e?.unsubscribe(),f=!0,b=_,e=(0,y.x)(m,x,h.Z),(0,d.Xf)(T(_)).subscribe(e)},()=>{x(),m.complete()},void 0,()=>{b=e=null}))})}},7265:($,S,a)=>{a.r(S),a.d(S,{SwapModule:()=>Fe});var p=a(8692),h=a(7976),y=a(8239),d=a(2024),k=a(4121),T=a(1528),A=a(2147),m=a(3151),f=a(2673),b=a(3349),e=a(4537),x=a(8696),_=a(9376),W=a(3755),K=a(4602),H=a(1730),P=a(3331),z=a(9638),L=a(7327),I=a(92),U=a(132),V=a(5372),B=a(9369),R=a(9779),E=a(4945),G=a(7241),X=a(5557),ee=a(3933),D=a(4970),u=a(8168),F=a(5598),te=a(5619),ne=a(7969),oe=a(3568);function Q(i){return Boolean(i.parentElement&&"picture"===i.parentElement.nodeName.toLowerCase())}function C(i){return"img"===i.nodeName.toLowerCase()}function J(i,o,t){return C(i)?t&&"srcset"in i?i.srcset=o:i.src=o:i.style.backgroundImage=`url('${o}')`,i}function M(i){return o=>{const t=o.parentElement.getElementsByTagName("source");for(let n=0;n<t.length;n++){const s=t[n].getAttribute(i);s&&("srcset"in t[n]?t[n].srcset=s:t[n].src=s)}}}const se=M("defaultImage"),Y=M("lazyLoad"),ae=M("errorImage");function Z(i){return(o,t,n)=>{C(o)&&Q(o)&&i(o),t&&J(o,t,n)}}const re=Z(se),le=Z(Y),ce=Z(ae);function j(i,o){i.className=i.className.replace(o,"")}function O(i,o){i.className.includes(o)||(i.className+=` ${o}`)}class ge extends class ue extends class de{constructor(){this.navigator=function ie(){return typeof window<"u"?window.navigator:void 0}()}setPlatformId(o){this.platformId=o}onDestroy(o){}onAttributeChange(o){}}{setup(o){re(o.element,o.defaultImagePath,o.useSrcset),o.imagePath&&O(o.element,"ng-lazyloading"),function pe(i,o){return i.className&&i.className.includes(o)}(o.element,"ng-lazyloaded")&&j(o.element,"ng-lazyloaded")}finally(o){O(o.element,"ng-lazyloaded"),j(o.element,"ng-lazyloading")}loadImage(o){if(this.skipLazyLoading(o))return[o.imagePath];const{element:t,useSrcset:n,imagePath:s,decode:r}=o;let l;return C(t)&&Q(t)?(l=t.parentNode.cloneNode(!0).getElementsByTagName("img")[0],Y(l),J(l,s,n)):(l=new Image,C(t)&&t.referrerPolicy&&(l.referrerPolicy=t.referrerPolicy),C(t)&&t.sizes&&(l.sizes=t.sizes),n&&"srcset"in l?l.srcset=s:l.src=s),r&&l.decode?l.decode().then(()=>s):new Promise((g,w)=>{l.onload=()=>g(s),l.onerror=()=>w(null)})}setErrorImage(o,t){const{element:n,useSrcset:s,errorImagePath:r}=t;ce(n,r,s),O(n,"ng-failed-lazyloaded")}setLoadedImage(o,t){const{element:n,useSrcset:s}=t;le(n,o,s)}isDisabled(){return(0,p.PM)(this.platformId)&&!this.isBot()}skipLazyLoading(o){return this.isBot(o)}isBot(o){return!!this.navigator?.userAgent&&/googlebot|bingbot|yandex|baiduspider|facebookexternalhit|twitterbot|rogerbot|linkedinbot|embedly|quora\ link\ preview|showyoubot|outbrain|pinterest\/0\.|pinterestbot|slackbot|vkShare|W3C_Validator|whatsapp|duckduckbot|prerender/i.test(this.navigator.userAgent)}}{constructor(){super(...arguments),this.observers=new WeakMap,this.intersectionSubject=new R.x,this.uniqKey={}}getObservable(o){if(this.skipLazyLoading(o))return(0,E.of)({isIntersecting:!0});if(o.customObservable)return o.customObservable;const t=o.scrollContainer||this.uniqKey,n={root:o.scrollContainer||null};o.offset&&(n.rootMargin=`${o.offset}px`);let s=this.observers.get(t);return s||(s=new IntersectionObserver(r=>this.loadingCallback(r),n),this.observers.set(t,s)),s.observe(o.element),G.y.create(r=>{const l=this.intersectionSubject.pipe((0,D.h)(g=>g.target===o.element)).subscribe(r);return()=>{l.unsubscribe(),s.unobserve(o.element)}})}isVisible(o){return o.isIntersecting}loadingCallback(o){o.forEach(t=>this.intersectionSubject.next(t))}}const q=new e.OlP("LazyLoadImageHooks");let he=(()=>{class i{constructor(t,n,s,r){this.onStateChange=new e.vpe,this.elementRef=t,this.ngZone=n,this.propertyChanges$=new X.t,this.hooks=r,this.hooks.setPlatformId(s),this.uid=Math.random().toString(36).substr(2,9)}ngOnChanges(){!0===this.debug&&!this.debugSubscription&&(this.debugSubscription=this.onStateChange.subscribe(t=>console.log(t))),this.propertyChanges$.next({element:this.elementRef.nativeElement,imagePath:this.lazyImage,defaultImagePath:this.defaultImage,errorImagePath:this.errorImage,useSrcset:this.useSrcset,offset:this.offset?0|this.offset:0,scrollContainer:this.scrollTarget,customObservable:this.customObservable,decode:this.decode,onStateChange:this.onStateChange,id:this.uid})}ngAfterContentInit(){if(this.hooks.isDisabled())return null;this.ngZone.runOutsideAngular(()=>{this.loadSubscription=this.propertyChanges$.pipe((0,u.b)(t=>this.hooks.onAttributeChange(t)),(0,u.b)(t=>t.onStateChange.emit({reason:"setup"})),(0,u.b)(t=>this.hooks.setup(t)),(0,T.w)(t=>t.imagePath?this.hooks.getObservable(t).pipe(function fe(i,o){return t=>t.pipe((0,u.b)(n=>o.onStateChange.emit({reason:"observer-emit",data:n})),(0,D.h)(n=>i.isVisible(n,o)),(0,F.q)(1),(0,u.b)(()=>o.onStateChange.emit({reason:"start-loading"})),(0,te.z)(()=>i.loadImage(o)),(0,u.b)(()=>o.onStateChange.emit({reason:"mount-image"})),(0,u.b)(n=>i.setLoadedImage(n,o)),(0,u.b)(()=>o.onStateChange.emit({reason:"loading-succeeded"})),(0,ne.U)(()=>!0),(0,oe.K)(n=>(o.onStateChange.emit({reason:"loading-failed",data:n}),i.setErrorImage(n,o),(0,E.of)(!1))),(0,u.b)(()=>{o.onStateChange.emit({reason:"finally"}),i.finally(o)}))}(this.hooks,t)):(0,ee.F)())).subscribe({next:()=>null})})}ngOnDestroy(){this.propertyChanges$.pipe((0,F.q)(1)).subscribe({next:t=>this.hooks.onDestroy(t)}).unsubscribe(),this.loadSubscription?.unsubscribe(),this.debugSubscription?.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(e.SBq),e.Y36(e.R0b),e.Y36(e.Lbi),e.Y36(q))},i.\u0275dir=e.lG2({type:i,selectors:[["","lazyLoad",""]],inputs:{lazyImage:["lazyLoad","lazyImage"],defaultImage:"defaultImage",errorImage:"errorImage",scrollTarget:"scrollTarget",customObservable:"customObservable",offset:"offset",useSrcset:"useSrcset",decode:"decode",debug:"debug"},outputs:{onStateChange:"onStateChange"},features:[e.TTD]}),i})(),me=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[{provide:q,useClass:ge}]}),i})();class c{constructor(o,t,n,s){this.left=o,this.top=t,this.right=n,this.bottom=s}static fromElement(o){const{left:t,top:n,right:s,bottom:r}=o.getBoundingClientRect();return 0===t&&0===n&&0===s&&0===r?c.empty:new c(t,n,s,r)}static fromWindow(o){return new c(0,0,o.innerWidth,o.innerHeight)}inflate(o){this.left-=o,this.top-=o,this.right+=o,this.bottom+=o}intersectsWith(o){return o.left<this.right&&this.left<o.right&&o.top<this.bottom&&this.top<o.bottom}getIntersectionWith(o){const t=Math.max(this.left,o.left),n=Math.max(this.top,o.top),s=Math.min(this.right,o.right),r=Math.min(this.bottom,o.bottom);return s>=t&&r>=n?new c(t,n,s,r):c.empty}}function be(i,o){1&i&&e.GkF(0)}function _e(i,o){1&i&&e.GkF(0)}function ve(i,o){1&i&&(e.TgZ(0,"div",22)(1,"mat-icon",23),e._uU(2,"autorenew"),e.qZA()())}function we(i,o){1&i&&(e.TgZ(0,"mat-icon",27),e._uU(1,"autorenew "),e.qZA())}function Te(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",25),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2),r=e.MAs(57);return e.KtG(s.openConfirmDialog(r))}),e.YNc(1,we,2,0,"mat-icon",26),e._uU(2,"Swap "),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("disabled",t.parseInt(t.nftValue)<=0||t.isQuerying||t.isSwapping||t.isLoadingSwapInfo),e.xp6(1),e.Q6J("ngIf",t.isQuerying||t.isSwapping||t.isLoadingSwapInfo)}}function xe(i,o){1&i&&(e.TgZ(0,"button",28),e._uU(1,"Insufficient Balance"),e.qZA()),2&i&&e.Q6J("disabled",!0)}function Ce(i,o){1&i&&(e.TgZ(0,"mat-icon",27),e._uU(1,"autorenew"),e.qZA())}function Se(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",25),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.approveToken())}),e.YNc(1,Ce,2,0,"mat-icon",29),e._uU(2,"Approve Token "),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("disabled",t.isQuerying),e.xp6(1),e.Q6J("ngIf",t.isQuerying)}}function ye(i,o){1&i&&(e.TgZ(0,"mat-icon",27),e._uU(1,"autorenew"),e.qZA())}function ke(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",25),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.approveNft())}),e.YNc(1,ye,2,0,"mat-icon",26),e._uU(2,"Approve NFTs "),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("disabled",t.isQuerying),e.xp6(1),e.Q6J("ngIf",t.isQuerying)}}function Ae(i,o){if(1&i&&(e.ynx(0),e.YNc(1,Te,3,2,"button",24),e.YNc(2,xe,2,1,"button",18),e.YNc(3,Se,3,2,"button",24),e.YNc(4,ke,3,2,"button",24),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.isApproved&&(0==t.mode&&t.parseFloat(t.tokenValue)<=t.parseFloat(t.userTokenBalance)||1==t.mode&&t.parseInt(t.nftValue)<=t.userNftBalance)),e.xp6(1),e.Q6J("ngIf",t.isApproved&&(0==t.mode&&t.parseFloat(t.tokenValue)>t.parseFloat(t.userTokenBalance)||1==t.mode&&t.parseInt(t.nftValue)>t.userNftBalance)),e.xp6(1),e.Q6J("ngIf",0==t.mode&&!t.isApproved),e.xp6(1),e.Q6J("ngIf",1==t.mode&&!t.isApproved)}}function Ie(i,o){1&i&&(e.TgZ(0,"button",28),e._uU(1,"Invalid Pair"),e.qZA()),2&i&&e.Q6J("disabled",!0)}function Me(i,o){1&i&&(e.TgZ(0,"mat-icon",42),e._uU(1," check_circle "),e.qZA())}c.empty=new c(0,0,0,0);const Ze=function(i){return{"selected-tokenId":i}};function Oe(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",39),e.NdJ("click",function(){const r=e.CHM(t).$implicit,l=e.oxw(3);return e.KtG(l.addOrRemoveTokenId(l.hexToString(r.id.tokenId)))}),e.YNc(1,Me,2,0,"mat-icon",40),e._UZ(2,"img",41),e.TgZ(3,"div"),e._uU(4),e.qZA()()}if(2&i){const t=o.$implicit,n=e.oxw(3);e.Q6J("ngClass",e.VKq(6,Ze,n.isSelectedTokenId(n.hexToString(t.id.tokenId)))),e.xp6(1),e.Q6J("ngIf",n.isSelectedTokenId(n.hexToString(t.id.tokenId))),e.xp6(1),e.Q6J("lazyLoad",null!=t&&null!=t.media&&null!=t.media[0]&&t.media[0].gateway?t.media[0].gateway:"/assets/imgs/mockNft.png")("defaultImage","/assets/imgs/mockNft.png")("alt",t.title),e.xp6(2),e.Oqu("#"+n.hexToString(t.id.tokenId))}}function Ne(i,o){if(1&i&&(e.TgZ(0,"div",37),e.YNc(1,Oe,5,8,"div",38),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("ngForOf",1==t.mode?t.userNftList:t.poolNftList)("ngForTrackBy",t.trackByNftItems)}}function Pe(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",30)(1,"nz-input-number",31),e.NdJ("ngModelChange",function(s){e.CHM(t);const r=e.oxw();return e.KtG(r.nftValue=s)})("ngModelChange",function(s){e.CHM(t);const r=e.oxw();return e.KtG(r.updateTokenValue(s))}),e.qZA(),e.TgZ(2,"div",32),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.openSearchTokenOrCollectionDialog(1))}),e._UZ(3,"img",33)(4,"div",4),e.TgZ(5,"span"),e._uU(6),e.qZA(),e._UZ(7,"div",4),e.qZA(),e.TgZ(8,"nz-slider",34),e.NdJ("ngModelChange",function(s){e.CHM(t);const r=e.oxw();return e.KtG(r.nftValue=s)})("ngModelChange",function(s){e.CHM(t);const r=e.oxw();return e.KtG(r.updateTokenValue(s))}),e.qZA(),e.TgZ(9,"div",35),e._uU(10),e.qZA()(),e.YNc(11,Ne,2,2,"ng-template",null,36,e.W1O)}if(2&i){const t=e.MAs(12),n=e.oxw();e.Q6J("nzPopoverContent",t)("nzPopoverVisible",(1==n.mode?n.userNftBalance:n.poolNftBalance)>0&&n.showPopover)("nzPopoverTrigger",null),e.xp6(1),e.Q6J("nzSize","large")("nzMin",0)("ngModel",n.nftValue)("nzPrecision",0),e.xp6(5),e.Oqu((null==n.pair||null==n.pair.collection?null:n.pair.collection.symbol)||n.collectionSymbol||"Select"),e.xp6(2),e.Q6J("ngModel",n.nftValue)("nzMax",1==n.mode?n.userNftBalance:n.poolNftBalance),e.xp6(2),e.hij("NFTs: ",1==n.mode?n.userNftBalance:n.poolNftBalance," ")}}function ze(i,o){if(1&i&&(e.TgZ(0,"div",46),e._uU(1),e.ALo(2,"number"),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.hij("Balance: ",e.xi3(2,1,t.userTokenBalance,"1.2-4")," ")}}function Le(i,o){1&i&&e._UZ(0,"div",46)}function Ue(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",43)(1,"nz-input-number",44),e.NdJ("ngModelChange",function(s){e.CHM(t);const r=e.oxw();return e.KtG(r.tokenValue=s)}),e.qZA(),e.TgZ(2,"div",32),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.openSearchTokenOrCollectionDialog(0))}),e._UZ(3,"img",33)(4,"div",4),e.TgZ(5,"span"),e._uU(6),e.qZA(),e._UZ(7,"div",4),e.qZA(),e.YNc(8,ze,3,4,"div",45),e.YNc(9,Le,1,0,"div",45),e.qZA()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("nzSize","large")("nzMin",0)("ngModel",t.tokenValue)("nzDisabled",!0),e.xp6(5),e.Oqu((null==t.pair||null==t.pair.token?null:t.pair.token.symbol)||t.tokenSymbol||"Select"),e.xp6(2),e.Q6J("ngIf",0==t.mode),e.xp6(1),e.Q6J("ngIf",1==t.mode)}}function Ve(i,o){1&i&&(e.TgZ(0,"mat-icon",50),e._uU(1,"autorenew "),e.qZA())}function Be(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",47)(1,"span",13),e._uU(2,"Confirm"),e.qZA(),e._UZ(3,"div",14),e.TgZ(4,"span",15),e._uU(5),e.qZA(),e.TgZ(6,"span",16),e._uU(7),e.qZA(),e.TgZ(8,"span",15),e._uU(9,"Slippage :"),e.qZA(),e.TgZ(10,"span",16),e._uU(11),e.ALo(12,"number"),e.qZA(),e.TgZ(13,"span",15),e._uU(14,"Royalty :"),e.qZA(),e.TgZ(15,"span",16),e._uU(16),e.ALo(17,"number"),e.qZA(),e.TgZ(18,"span",15),e._uU(19,"Trade fee :"),e.qZA(),e.TgZ(20,"span",16),e._uU(21),e.ALo(22,"number"),e.qZA(),e.TgZ(23,"span",15),e._uU(24),e.qZA(),e.TgZ(25,"span",16),e._uU(26),e.ALo(27,"number"),e.qZA(),e.TgZ(28,"button",48),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.confirmSwap())}),e.YNc(29,Ve,2,0,"mat-icon",49),e._uU(30,"Swap "),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(5),e.hij("You want to ",0==t.mode?"buy":"sell"," :"),e.xp6(2),e.AsE("",t.nftValue," ",null==t.pair||null==t.pair.collection?null:t.pair.collection.symbol,""),e.xp6(4),e.hij("",e.xi3(12,13,t.slippage,"1.2-2")," %"),e.xp6(5),e.AsE("",e.xi3(17,16,t.royalty,"1.2-4")," ",null==t.pair||null==t.pair.token?null:t.pair.token.symbol,""),e.xp6(5),e.AsE("",e.xi3(22,19,t.fee,"1.2-4")," ",null==t.pair||null==t.pair.token?null:t.pair.token.symbol,""),e.xp6(3),e.hij("Total ",0==t.mode?"Cost":"Receive"," :"),e.xp6(2),e.AsE("",e.xi3(27,22,t.tokenValue,"1.2-4")," ",null==t.pair||null==t.pair.token?null:t.pair.token.symbol,""),e.xp6(2),e.Q6J("disabled",!t.pair&&t.parseInt(t.nftValue)<=0||t.isQuerying||t.isSwapping),e.xp6(1),e.Q6J("ngIf",t.isQuerying||t.isSwapping)}}const Ee=[{path:"",component:(()=>{class i{constructor(t,n,s,r,l,g,w,N){this.location=t,this.route=n,this.router=s,this.matDialog=r,this.cacheService=l,this.httpService=g,this.accountService=w,this.web3Service=N,this.mode=0,this.nftValue="0",this.tokenValue="0",this.userNftBalance=0,this.userTokenBalance="0",this.userNftList=[],this.poolNftBalance=0,this.poolNftList=[],this.slippage="0",this.royalty="0",this.fee="0",this.isLoadingSwapInfo=!0,this.isApproved=!1,this.isQuerying=!0,this.isSwapping=!1,this.selectedTokenIds=[],this.showPopover=!0,this.queryNftValue$=new k.X("0")}ngOnInit(){var t=this;this.pair$=this.route.paramMap.pipe((0,T.w)(n=>(this.nftAddress=n.get("nftAddress")||void 0,this.baseTokenAddress=n.get("baseTokenAddress")||void 0,this.cacheService.getPairAddress(this.nftAddress,this.baseTokenAddress))),(0,A.x)((n,s)=>n?.address==s?.address&&n?.price==s?.price&&n?.nftAmount==s?.nftAmount)),this.sub=this.pair$.subscribe(function(){var n=(0,y.Z)(function*(s){t.pair=s,s?(t.tokenSymbol=s.token.symbol,t.collectionSymbol=s.collection.symbol,t.baseTokenDecimals=s.token.decimals):(t.tokenSymbol=t.baseTokenAddress&&(yield t.web3Service.getTokenSymbol(t.baseTokenAddress))[0],t.collectionSymbol=t.nftAddress&&(yield t.web3Service.getTokenSymbol(t.nftAddress))[0],t.baseTokenDecimals=t.baseTokenAddress&&(yield t.web3Service.getTokenDecimals(t.baseTokenAddress))[0]),t.fetchUserNFTs(),t.fetchPoolNFTs(),t.fetchUserTokenBalance()});return function(s){return n.apply(this,arguments)}}()),this.queryNftValueSub=this.queryNftValue$.pipe((0,m.b)(500),(0,T.w)(n=>this.pair&&parseInt(this.nftValue)>0?(this.isLoadingSwapInfo=!0,this.web3Service.invokeContract("IntswapV1Pair",0==this.mode?"getBuyQuotoInfo":"getSellQuotoInfo",[n],this.pair.address).then(s=>({baseTokenAmount:s[0],newPrice:d.O$.from(s[1]).pow(2).div(d.O$.from("10").pow(this.pair?.token.decimals||"18")).toString(),tradingFee:s[2],royaltyAmount:s[3]}))):Promise.resolve({baseTokenAmount:"0",newPrice:"0",tradingFee:"0",royaltyAmount:"0"}))).subscribe(n=>{if(this.pair&&parseInt(this.nftValue)>0){const s=d.O$.from(this.pair.price).div(d.O$.from("100000000000000")).toNumber();this.tokenValue=this.formatTokenValue(n.baseTokenAmount,this.pair.token.decimals||"18"),this.slippage=(100*Math.abs(d.O$.from(n.newPrice).div(d.O$.from("100000000000000")).toNumber()-s)/s).toFixed(2),this.royalty=this.formatTokenValue(n.royaltyAmount,this.pair?.token.decimals||"18"),this.fee=this.formatTokenValue(n.tradingFee,this.pair.token.decimals||"18")}this.isLoadingSwapInfo=!1})}fetchUserTokenBalance(){this.accountBalanceSub?.unsubscribe(),this.accountBalanceSub=this.accountService.account$.subscribe(t=>{t&&this.baseTokenAddress&&this.web3Service.invokeContract("ERC20","balanceOf",[t],this.baseTokenAddress).then(n=>{this.baseTokenDecimals&&(this.userTokenBalance=this.formatTokenValue(n[0],this.baseTokenDecimals),this.fetchAllowance())})})}updateTokenValue(t){t>=0&&(this.queryNftValue$.next(t),this.updateSelectedTokenIds(t)),0==t&&(this.nftValue="0",this.tokenValue="0",this.slippage="0.00",this.royalty="0",this.fee="0")}updateSelectedTokenIds(t){this.selectedTokenIds=(1==this.mode?this.userNftList:this.poolNftList).slice(0,t).map(n=>this.hexToString(n.id.tokenId))}isSelectedTokenId(t){return this.selectedTokenIds.includes(t)}addOrRemoveTokenId(t){this.isSelectedTokenId(t)?this.selectedTokenIds.splice(this.selectedTokenIds.indexOf(t),1):this.selectedTokenIds.push(t),this.nftValue=this.selectedTokenIds.length+"",this.queryNftValue$.next(this.nftValue),0==this.selectedTokenIds.length&&(this.nftValue="0",this.tokenValue="0",this.slippage="0.00",this.royalty="0",this.fee="0")}formatTokenValue(t,n){return(0,f.formatUnits)(t,n)}fetchUserNFTs(){this.accountNFTsSub?.unsubscribe(),this.accountNFTsSub=this.accountService.account$.subscribe(t=>{t&&this.nftAddress&&this.httpService.fetchNFTsOfCollectionByOwnerAddress(t,this.nftAddress,!0).then(n=>{this.userNftList=n.ownedNfts,this.userNftBalance=n.totalCount})})}fetchPoolNFTs(){this.pair&&this.httpService.fetchNFTsOfCollectionByOwnerAddress(this.pair.address,this.pair.collection.address,!0).then(t=>{if(this.poolNftList=t.ownedNfts,this.poolNftBalance=t.totalCount,0==this.mode){const s=this.route.snapshot.queryParams.prevSelectTokenId;s&&!this.isSelectedTokenId(s)&&(this.selectedTokenIds.push(s),this.nftValue=this.selectedTokenIds.length+"",this.queryNftValue$.next(this.nftValue))}})}trackByNftItems(t,n){return n.contract.address+""+n.id.tokenId}parseInt(t){return parseInt(t)}parseFloat(t){return parseFloat(t)}goBack(){this.location.back()}switchMode(){this.mode=1==this.mode?0:1,this.nftValue="0",this.tokenValue="0",this.slippage="0.00",this.royalty="0",this.fee="0",this.selectedTokenIds=[],this.fetchAllowance()}fetchAllowance(){this.isQuerying=!0,this.accountAllowanceSub?.unsubscribe(),this.accountAllowanceSub=this.accountService.account$.subscribe(t=>{t&&this.pair&&(0==this.mode?this.web3Service.invokeContract("ERC20","allowance",[t,this.pair.address],this.pair.token.address).then(n=>this.isApproved=d.O$.from(n[0]).gte(d.O$.from((0,f.parseUnits)(this.userTokenBalance,this.pair?.token.decimals)))).finally(()=>this.isQuerying=!1):this.web3Service.invokeContract("ERC721","isApprovedForAll",[t,this.pair.address],this.pair.collection.address).then(n=>this.isApproved=n[0]).finally(()=>this.isQuerying=!1))})}hexToString(t){return d.O$.from(t).toString()}openConfirmDialog(t){this.confirmDialog=this.matDialog.open(t,{autoFocus:!1})}confirmSwap(){this.confirmDialog&&(this.confirmDialog.disableClose=!0),this.pair&&(this.isSwapping=!0,this.web3Service.invokeContract("IntswapV1Pair",0==this.mode?"buySpecificNFTs":"sellSpecificNFTs",[this.selectedTokenIds,(0,f.parseUnits)(this.tokenValue,this.pair.token.decimals).toString()],this.pair.address).then(t=>{this.confirmDialog?.close(),this.nftValue="0",this.tokenValue="0",this.slippage="0.00",this.royalty="0",this.fee="0",this.fetchUserNFTs(),this.fetchPoolNFTs(),this.fetchUserTokenBalance()}).finally(()=>{this.confirmDialog&&(this.confirmDialog.disableClose=!1),this.isSwapping=!1,this.selectedTokenIds=[]}))}approveToken(){this.pair&&(this.isQuerying=!0,this.web3Service.invokeContract("ERC20","approve",[this.pair.address,b.fV],this.pair.token.address).then(()=>this.isApproved=!0).finally(()=>this.isQuerying=!1))}approveNft(){this.pair&&(this.isQuerying=!0,this.web3Service.invokeContract("ERC721","setApprovalForAll",[this.pair.address,"true"],this.pair.collection.address).then(()=>this.isApproved=!0).finally(()=>this.isQuerying=!1))}openSearchTokenOrCollectionDialog(t){a.e(8592).then(a.bind(a,2928)).then(({SearchTokenDialogComponent:n})=>{this.showPopover=!1;const s=this.matDialog.open(n);s.componentInstance.tokenType=t,s.afterClosed().subscribe(r=>{if(this.showPopover=!0,r)switch(t){case 0:this.switchToken(r.address,r.symbol,r.decimals);break;case 1:this.switchNft(r.address,r.symbol)}})})}switchNft(t,n){t&&this.router.navigate(this.baseTokenAddress?["app/swap/",t,this.baseTokenAddress]:["app/swap/",t]),this.collectionSymbol=n}switchToken(t,n,s){this.baseTokenAddress=t,this.tokenSymbol=n,this.baseTokenDecimals=s}ngOnDestroy(){this.sub?.unsubscribe(),this.queryNftValueSub?.unsubscribe(),this.accountBalanceSub?.unsubscribe(),this.accountAllowanceSub?.unsubscribe(),this.accountNFTsSub?.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(p.Ye),e.Y36(h.gz),e.Y36(h.F0),e.Y36(x.uw),e.Y36(_.Q),e.Y36(W.O),e.Y36(K.B),e.Y36(H.U))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-swap"]],decls:58,vars:30,consts:[[1,"card-wrapper"],[1,"card-header"],[1,"back-btn"],["mat-icon-button","",3,"click"],[1,"spacer"],[1,"card-title"],[1,"setting-btn"],[1,"divider"],[4,"ngTemplateOutlet"],[1,"switch-icon"],[3,"nzIndicator","nzDelay","nzSpinning"],["indicatorTemplate",""],[1,"swap-info"],[2,"min-height","24px","font-size","24px","font-weight","bolder","color","rgb(87, 87, 87)","grid-column-start","span 2"],[1,"result-divider"],[1,"swap-info-label"],[1,"swap-info-value"],[4,"ngIf"],["mat-button","","class","swap-btn",3,"disabled",4,"ngIf"],["nftInputTemplate",""],["tokenInputTemplate",""],["confirm",""],[2,"display","flex","width","100%","height","100%","align-items","center","justify-content","center"],["color","primary",1,"spin-icon"],["mat-button","","class","swap-btn",3,"disabled","click",4,"ngIf"],["mat-button","",1,"swap-btn",3,"disabled","click"],["color","warn","class","spin-icon querying-icon",4,"ngIf"],["color","warn",1,"spin-icon","querying-icon"],["mat-button","",1,"swap-btn",3,"disabled"],["color","warn","class","spin-icon  querying-icon",4,"ngIf"],["nz-popover","","nzPopoverPlacement","rightTop",1,"input-wrapper",3,"nzPopoverContent","nzPopoverVisible","nzPopoverTrigger"],["nzBorderless","","nzPrecisionMode","cut",1,"nft-input",3,"nzSize","nzMin","ngModel","nzPrecision","ngModelChange"],[1,"nft-menu-btn",3,"click"],["src","assets/imgs/logo1.png","alt","icon"],[1,"nft-slider",3,"ngModel","nzMax","ngModelChange"],[1,"nft-balance"],["nftList",""],[1,"nft-list"],["class","nft-list-item",3,"ngClass","click",4,"ngFor","ngForOf","ngForTrackBy"],[1,"nft-list-item",3,"ngClass","click"],["class","selected-tokenId-icon","color","warn",4,"ngIf"],[3,"lazyLoad","defaultImage","alt"],["color","warn",1,"selected-tokenId-icon"],[1,"input-wrapper",2,"cursor","no-drop"],["nzBorderless","",1,"nft-input",3,"nzSize","nzMin","ngModel","nzDisabled","ngModelChange"],["class","token-balance",4,"ngIf"],[1,"token-balance"],[1,"swap-info",2,"background","rgb(255, 255, 255)"],["mat-button","",1,"swap-btn",2,"grid-column-start","span 2","width","60%","justify-self","center","align-self","center","min-height","36px","font-size","24px","margin-top","12px",3,"disabled","click"],["color","warn","class","spin-icon querying-icon","style","top: 6px; left:12px;",4,"ngIf"],["color","warn",1,"spin-icon","querying-icon",2,"top","6px","left","12px"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),e.NdJ("click",function(){return n.goBack()}),e.TgZ(4,"mat-icon"),e._uU(5,"arrow_back"),e.qZA()()(),e._UZ(6,"div",4),e.TgZ(7,"div",5)(8,"span"),e._uU(9,"Swap"),e.qZA()(),e._UZ(10,"div",4)(11,"div",6),e.qZA(),e._UZ(12,"div",7),e.YNc(13,be,1,0,"ng-container",8),e.TgZ(14,"div",9)(15,"button",3),e.NdJ("click",function(){return n.switchMode()}),e.TgZ(16,"mat-icon"),e._uU(17,"arrow_downward"),e.qZA()()(),e.YNc(18,_e,1,0,"ng-container",8),e.TgZ(19,"nz-spin",10),e.YNc(20,ve,3,0,"ng-template",null,11,e.W1O),e.TgZ(22,"div",12)(23,"span",13),e._uU(24,"Swap Info"),e.qZA(),e._UZ(25,"div",14),e.TgZ(26,"span",15),e._uU(27),e.qZA(),e.TgZ(28,"span",16),e._uU(29),e.qZA(),e.TgZ(30,"span",15),e._uU(31,"Slippage :"),e.qZA(),e.TgZ(32,"span",16),e._uU(33),e.ALo(34,"number"),e.qZA(),e.TgZ(35,"span",15),e._uU(36,"Royalty :"),e.qZA(),e.TgZ(37,"span",16),e._uU(38),e.ALo(39,"number"),e.qZA(),e.TgZ(40,"span",15),e._uU(41,"Trade fee :"),e.qZA(),e.TgZ(42,"span",16),e._uU(43),e.ALo(44,"number"),e.qZA(),e.TgZ(45,"span",15),e._uU(46),e.qZA(),e.TgZ(47,"span",16),e._uU(48),e.ALo(49,"number"),e.qZA()()(),e.YNc(50,Ae,5,4,"ng-container",17),e.YNc(51,Ie,2,1,"button",18),e.qZA(),e.YNc(52,Pe,13,11,"ng-template",null,19,e.W1O),e.YNc(54,Ue,10,7,"ng-template",null,20,e.W1O),e.YNc(56,Be,31,25,"ng-template",null,21,e.W1O)),2&t){const s=e.MAs(21),r=e.MAs(53),l=e.MAs(55);e.xp6(13),e.Q6J("ngTemplateOutlet",1==n.mode?r:l),e.xp6(5),e.Q6J("ngTemplateOutlet",1==n.mode?l:r),e.xp6(1),e.Q6J("nzIndicator",s)("nzDelay",200)("nzSpinning",n.isLoadingSwapInfo),e.xp6(8),e.hij("You want to ",0==n.mode?"buy":"sell"," :"),e.xp6(2),e.AsE("",n.nftValue," ",null==n.pair||null==n.pair.collection?null:n.pair.collection.symbol,""),e.xp6(4),e.hij("",e.xi3(34,18,n.slippage,"1.2-2")," %"),e.xp6(5),e.AsE("",e.xi3(39,21,n.royalty,"1.2-4")," ",null==n.pair||null==n.pair.token?null:n.pair.token.symbol,""),e.xp6(5),e.AsE("",e.xi3(44,24,n.fee,"1.2-4")," ",null==n.pair||null==n.pair.token?null:n.pair.token.symbol,""),e.xp6(3),e.hij("Total ",0==n.mode?"Cost":"Receive"," :"),e.xp6(2),e.AsE("",e.xi3(49,27,n.tokenValue,"1.2-4")," ",null==n.pair||null==n.pair.token?null:n.pair.token.symbol,""),e.xp6(2),e.Q6J("ngIf",n.pair),e.xp6(1),e.Q6J("ngIf",!n.pair)}},dependencies:[p.mk,p.sg,p.O5,p.tP,P.Hw,z.lW,L._V,I.JJ,I.On,U.lU,V.jS,B.W,he,p.JJ],styles:[".card-wrapper[_ngcontent-%COMP%]{position:relative;max-width:420px;width:100%;border-radius:16px;border:1px solid rgba(94,104,135,.24);margin-top:1rem;margin-left:auto;margin-right:auto;min-height:60vh;background:#fff;padding:12px}.card-header[_ngcontent-%COMP%]{width:100%;height:48px;display:flex;flex-direction:row;justify-content:center;align-items:center}.card-title[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:24px;font-weight:700}.spacer[_ngcontent-%COMP%]{flex:1 1 auto}.setting-btn[_ngcontent-%COMP%]{min-width:40px}.divider[_ngcontent-%COMP%]{height:1px;width:100%;margin:8px 0 16px;background:linear-gradient(90deg,#ff00d0 0%,#ffa600 100%)}.input-wrapper[_ngcontent-%COMP%]{min-height:96px;width:100%;border-radius:16px;background:rgba(243,243,243,.3);border:2px solid rgba(94,104,135,0);transition:all .2s;display:grid;grid-template-columns:5fr 2fr;column-gap:12px;justify-items:center;align-items:center;box-sizing:border-box;padding:12px 12px 0}.input-wrapper[_ngcontent-%COMP%]:hover{border:2px solid rgba(228,178,201,.24)}[_nghost-%COMP%]     .ant-input-number-handler{border:none!important}[_nghost-%COMP%]     .ant-input-number-disabled{background:transparent}.nft-input[_ngcontent-%COMP%]{width:100%;font-size:28px;color:#7f7f7f}.nft-menu-btn[_ngcontent-%COMP%]{width:100%;border-radius:16px;background:linear-gradient(45deg,#febae6 0%,#f9e1b4 100%);display:flex;justify-content:center;align-items:center;flex-direction:row;min-height:36px;padding:12px;cursor:pointer}.nft-menu-btn[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:24px;height:24px}.nft-menu-btn[_ngcontent-%COMP%]:hover{background:linear-gradient(45deg,#f7d8fd 0%,#f9e6c2 100%)}.nft-slider[_ngcontent-%COMP%]{width:100%;margin:0 24px 0 36px}[_nghost-%COMP%]     .ant-slider:hover .ant-slider-handle:not(.ant-tooltip-open){border-color:#ffe6b8}[_nghost-%COMP%]     .ant-slider-track{background:linear-gradient(45deg,#f7d8fd 0%,#f9e6c2 100%)}[_nghost-%COMP%]     .ant-slider-handle{border:2px solid #ffa3da}.nft-balance[_ngcontent-%COMP%]{justify-self:end}.token-balance[_ngcontent-%COMP%]{grid-column-start:span 2;justify-self:end}.switch-icon[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;align-items:center;margin:12px 0}.switch-icon[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:linear-gradient(45deg,#f3bffc 0%,#ffe6b9 100%)}.switch-icon[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{color:#fff}.swap-info[_ngcontent-%COMP%]{margin:24px 0;width:100%;padding:12px;box-sizing:border-box;display:grid;grid-template-columns:2fr 3fr;font-size:18px;border-radius:16px;background:rgba(243,243,243,.3);border:2px solid rgba(94,104,135,0);transition:all .2s}.swap-info[_ngcontent-%COMP%]:hover{border:2px solid rgba(228,178,201,.24)}.swap-info-label[_ngcontent-%COMP%]{width:100%;justify-self:start;align-self:center}.swap-info-value[_ngcontent-%COMP%]{justify-self:end;align-self:center}.swap-btn[_ngcontent-%COMP%]{position:relative;width:100%;min-height:72px;border-radius:16px;background:linear-gradient(45deg,#ffb6db 0%,#fadba2 100%);color:#fff;font-size:36px;font-weight:bolder;margin-bottom:12px}.result-divider[_ngcontent-%COMP%]{width:25vw;max-height:50vh;grid-column-start:span 2;height:1px;width:100%;margin:12px auto;background:linear-gradient(90deg,#fed9f7 0%,#ffecc9 100%)}.nft-list[_ngcontent-%COMP%]{width:25vw;height:50vh;overflow-x:hidden;overflow-y:auto;display:grid;grid-template-columns:1fr 1fr 1fr 1fr;row-gap:6px;column-gap:6px;padding:12px;margin:0 -12px}.nft-list-item[_ngcontent-%COMP%]{width:100%;height:15vh;display:flex;align-items:center;justify-content:center;flex-direction:column;border:2px solid;border-image:linear-gradient(135deg,#fce6be 0%,#f3c4ff 100%) 1;overflow:hidden;box-sizing:border-box;position:relative;cursor:pointer;transition:all .2s}.nft-list-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:12vh;margin-bottom:12px}.nft-list-item[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:100%;height:32px;text-align:center;overflow:hidden;text-overflow:ellipsis}.nft-list-item[_ngcontent-%COMP%]:hover{transform:scale(1.1);border-image:linear-gradient(135deg,#ffcb82 0%,#fd87ff 100%) 1;background:#fff;z-index:5}.selected-tokenId[_ngcontent-%COMP%]{border-image:linear-gradient(135deg,#feb856 0%,#fc64ff 100%) 1}.selected-tokenId-icon[_ngcontent-%COMP%]{position:absolute;top:4px;right:4px;background:#fff;border-radius:50%}.spin-icon[_ngcontent-%COMP%]{transform:rotate(45deg);animation:rotate 1.2s infinite linear}.querying-icon[_ngcontent-%COMP%]{position:absolute;left:24px;top:24px}@keyframes rotate{to{transform:rotate(405deg)}}"]}),i})()}];let De=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[h.Bz.forChild(Ee),h.Bz]}),i})(),Fe=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[p.ez,De,P.Ps,z.ot,L.Zf,I.u5,U.$6,V.N3,B.j,x.Is,me]}),i})()}}]);